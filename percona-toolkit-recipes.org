#+LaTeX_CLASS: beamer
#+MACRO: BEAMERMODE presentation
#+MACRO: BEAMERTHEME boxes
#+MACRO: BEAMERCOLORTHEME lily
#+MACRO: BEAMERSUBJECT RMRF
#+MACRO: BEAMERINSTITUTE Percona Inc., Square Inc. 
#+TITLE: Percona Toolkit Recipes
#+AUTHOR: Marcos Albe, Fernando Ipar, Ryan Lowe
#+OPTIONS: ^:nil

# Some comments and/or 'presenter notes' included. The slides are
# intentionally minimal as this will be focused on short demos for
# every recipe instead. 

* Introduction
** About us
Who we are and what we do
# I want to keep text to the minimum necessary, so let's just present
# ourselves verbally here. 
** Why should you be here?
If you manage MySQL servers, *don't* reinvent the wheel :)
# Percona toolkit provides properly tested and documented solutions to
# problems that are frequently handled by home brewed scripts instead
# (pt-archiver is a very good example). 
# Don't reinvent the wheel, find and use a proper tool instead. The
# recipes will provide a good starting point for you to build a
# solution tailored to your specific version of the problem. 
* Problems
** List of problems for review
- Making sure replication works as expected
  - Verifying replicas
  - Making them consistent again if needed
- Performance optimization
  - Identifying the best goals for our effort
  - Sistematic review of 'bad' queries
- Upgrading MySQL
  - Having the odds on our side
- Troubleshooting
  - Investigating hard to diagnose problems
- Operations
  - Altering a table without downtime
  - Archiving unused data
* Recipes
** Verifying replicas
pt-table-checksum
** pt-table-checksum
Many things can break MySQL replication
- Writing to a replica
- Nondeterministic SQL and SBR
- Difference in storage engines
- Temporary tables
- Filtering
- ...
** pt-table-checksum
Recipe demo: how to verify a three node setup
# TODO: short demo. 
** Making a replica consistent with its master
pt-table-sync
** pt-table-sync
Recipe demo: resyncing
# TODO: Mention gotchas (like impossibility to throttle the process)
# TODO: short demo
** Finding good candidates for query optimization
How? pt-query-digest

Why? *Amdahl's law*
# The performance enhancement possible with a given improvement is
# limited by the fraction of the execution time that the improved
# feature is used. 
** pt-query-digest
Recipe: Analyzing a query log looking for candidates for performance optimization
# TODO: slides presenting relevant parts from a report
** Systematic query reviews
pt-query-digest
# TODO: short demo OR slides presenting review data
** Safe(r) upgrades
pt-upgrade
** pt-upgrade
2 ways to upgrade MySQL: 
- Reckless
- Safe
- http://bit.ly/upgrading-mysql
# TODO: slides presenting highlights from a report
** Finding the root cause
pt-stalk / pt-sift
# TODO: Generate problem cases so we can create slides with good
# capture data
** pt-stalk
Why?

"Everything freezes at random times"
** pt-stalk : triggered captures
Triggers based on 
- show global status
- show full processlist
- user defined function
** pt-stalk : trigger examples
pt-stalk --function processlist --variable Command --match Sleep
--threshold 155 --cycles 0
# Trigger if we're using a thread pool and more threads are connected
# and sleeping than the size of the pol plus some room for a few
# direct connections. 
** pt-stalk : trigger examples
pt-stalk --threshold 40 --cycles 6
# Trigger if more than 40 threads are running for more than 5
# consecutive checks
** pt-stalk : trigger examples
pt-stalk --function check_loadavg.sh --threshold 12
# triggers if load avg for the last minute is more than 12.x for 5
# consecutive checks or more
** pt-stalk : function trigger example
function trg_plugin() 

{

   uptime |sed 's/.*load average: //g;s/\..*//g'

}
** pt-stalk : making sense of a capture
Now ... Where do we start?

pt-sift!
** pt-sift
#+CAPTION: Sample pt-sift summary
[[./img/pt-sift.png]]
** Online alter table
pt-online-schema-change
# TODO: short demo
** Archiving unused tables and/or old data
pt-archive
# TODO: short demo
** Delayed Replication Slave
pt-slave-delay
# TODO: short demo
* Resources
** Resources
http://bit.ly/pt-recipes
